# CALayer

**CALayer** – это базовый класс для отображения графики и анимаций на экране. Он образует «фундамент» отрисовки в Core Animation: каждая UIView по умолчанию имеет свой layer, который отвечает за визуализацию, анимации, тени, градиенты и пр.

### Чем полезен CALayer?

- с его помощью можно создавать гибкие анимации, и визуальные эффекты, не прибегая к UIView.
- Сложные графические элементы, как карта, «particle effects», и т. д. – CALayer, и его подклассы, позволит это делать более «низкоуровнево» и эффективно.
- Быстрая отрисовка — GPU-ускорение.

### Зачем он нужен?

- Основная единица рендеринга. Все визуальные эффекты, анимации, и графические трансформации идут через слой — CALayer. Слой предоставляет низкоуровневые API для GPU-ускоренного рендеринга, кэширования и преобразований.
- Анимации. Изменение opacity, position, масштаб и вращение — через transform, изменения «углов» — всё это CALayer умеет анимировать «бесплатно» — implicit animations.
- Продвинутая графика. Поддержка теней — shadowColor, shadowOpacity, shadowOffset, градиентов, masking, и прочих сложных визуальных эффектов.
- Отделение логики и визуализации. UIView хранит «логику взаимодействия» — тач-события, жизненный цикл, а CALayer фактически рисует и анимирует.

### Что умеет делать CALayer?

- Отображать контент. Растеризованный — изображения, contents, или векторный — через `draw(in:)` или `drawLayer:inContext:`.
- Анимировать. Перемещение — это position, изменение размера — это `bounds`, прозрачность — это `opacity`, вращение — это `transform`, и т.д. Анимации могут быть неявными — это implicit, или явными, через `CABasicAnimation`, `CAKeyframeAnimation`, `CATransition`.
- Маскирование. Установка layer.mask позволяет показывать лишь часть слоя. Это даёт возможность вырезать сложные формы, «затемнять» фрагменты, и т.п.
- Тени, градиенты. `shadowColor`, `shadowOpacity`, `shadowOffset`, `shadowRadius`, `cornerRadius`, а также отдельные подклассы, например, `CAGradientLayer`, `CAReplicatorLayer`.
- Аппаратное ускорение. Использует GPU для рендеринга, кэшируя слои.

### Сравнение UIView и CALayer

| Свойство / функция                 | UIView                                                     | CALayer                                                                 |
|------------------------------------|------------------------------------------------------------|-------------------------------------------------------------------------|
| Обработка пользовательского ввода  | ✅ — touchesBegan, touchesMoved и т.д.                      | ❌ — не обрабатывает жесты или события.                                 |
| Низкоуровневая графическая обработка| ❌                                                           | ✅ — Core Animation, маски, тени, трансформации.                        |
| Управление жизненным циклом        | ✅ — viewDidLoad, viewWillAppear и т.п.                     | ❌ — у слоя нет методов жизненного цикла.                                |
| Анимации                           | ❌                                                           | ✅ — implicit animations, CABasicAnimation, CAKeyframeAnimation и т.д.   |
| Использование для рендеринга       | ❌ — Делегирует рендер через свой .layer                    | ✅ — Базовый низкоуровневый компонент для рисования                      |
| Высокоуровневые методы UI          | ✅ — автокомпоновка, layoutSubviews, etc.                   | ❌ — чистая графика + анимации.                                         |
