# Процесс компиляции 

### Xcode

У нас есть Swift-файлы с нашей программой. Мы отдаём их Xcode и первое, что их встретит — это препроцессор. На вход препроцессора мы отдаем Swift-файлы. На выходе получаем Swift-файлы.

<img src="img/xcode.png" alt="xcode" width="800" height="350">

Что происходит внутри препроцессора? 

### Препроцессор

```swift
#if DEBUG
    print(“hello world”)
#endif
```

В англоязычном коммьюнити это называется Active Compilation Conditions. Это вещи, благодаря которым препроцессор понимает, какой Swift-код вам оставить. 

- Если условие удовлетворяет текущему положению вещей, когда вы билдите, препроцессор оставляет этот Swift-код.
- Если не удовлетворяет — вырезает, будто ничего и не было.

<img src="img/preprocessor.png" alt="preprocessor" width="700" height="300">

На этом задача препроцессора заканчивается. 

Дальше ваш Swift-код встретит компилятор.

### Компилятор

Результат работы компилятора — Assembly-код. 

<img src="img/compil.png" alt="compil" width="700" height="300">

#### Что происходит внутри компилятора?

- На вход компилятора приходит Swift-код.
- Внутри код компилируется в intermediate-код.
- На выходе компилятор отдаёт нам Assembly-код.

Когда мы говорим об оптимизациях на этапе компиляции, то подразумеваем оптимизации, которые происходят в момент компиляции intermediate языка. И происходят они вот здесь:

<img src="img/compile-optimize.png" alt="compil" width="700" height="300">

#### Появление Executable binary

Теперь у нас есть крутооптимизированный Assembly-код, который попадает в механизм под названием Assembler. 

И вот уже Assembler даёт нам тот самый машинный код, о котором мы говорили в начале. Теперь этот машинный код попадает в [статический линкер](04_Linking.md)

<img src="img/compile-linker.png" alt="compile-linker" width="700" height="300">

Помимо нашего машинного кода туда попадают и статические, и динамические библиотеки.

<img src="img/static-dynmayc-compile.png" alt="compile-linker" width="700" height="300">

И в этот момент как раз и происходит создание того самого Executable binary.

<img src="img/compele-binary.png" alt="compile-linker" width="700" height="300">
